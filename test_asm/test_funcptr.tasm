$stacksize 64    ; 64 stack cells

$global stdin, 8, word 0
$global string, 1, "Please enter a long string: "

$native %puts  # int puts(const char *);
$native %fgets  # char *fgets(char *, int, FILE *);

%main: {
# char string[256];
    movi        rgamal, 256
    sub         rsp, rgamal
    
# puts("Please enter a long string: ");
    ldvar       rarg0, string
    movi        ralaf, 1
    call        %puts
    
# fgets(string, 256, stdin);
    ldvar       rarg2, stdin ; loading a global var only loads its address, we need the actual ptr value of stdin.
    ld8         rarg2, [rarg2]
    
    movi        rarg1, 256
    
    ldaddr      rarg0, [rbp-256]
    
    movi        ralaf, 3
    ldfunc      rgamal, %fgets
    callr       rgamal
    
    movi        ralaf, 1
    call        %puts
    ret
}
