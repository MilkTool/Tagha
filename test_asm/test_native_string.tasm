$stacksize 0xFF    ; 255 stack cells

$global test_str, 1, "hello world\n"

; size_t strlen(const char *);
$native %strlen

; int main()
; {
;     size_t length = 0;
;     // 10 million.
;     for (int i = 0; i < 1000000000; i++)
;         length = strlen(s);
;     length *= 1000000000;
; }

%main: {
    movi       rgamal, 0
    movi       rheh, 1
    st4        [rbp-4], rgamal ; int length = 0;
    st4        [rbp-8], rgamal ; int i = 0;
    jmp        .L2
.L3:
    ldvar      rsemkath, test_str ; "hello world\n"
    movi       ralaf, 1
    call       %strlen ; strlen(s);
    st4        [rbp-4], ralaf ; length = strlen(s);
    ld4        rdalath, [rbp-8]
    add        rdalath, rheh
    st4        [rbp-8], rdalath ; i++
.L2:
    movi       rheh, 10000000 ; loop 10 mabillion times. 1000000000, 10000000
    ld4        rwaw, [rbp-8] ;
    ult        rwaw, rheh ; i < 10,000,000
    jnz        .L3
    ld4        rzain, [rbp-4]
    mul        rzain, rheh
    mov        ralaf, rzain
    ret
}
